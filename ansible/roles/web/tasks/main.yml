---
- name: Check if the operating system is Amazon Linux
  command: cat /etc/os-release
  register: os_info
  changed_when: false

- name: Install Nginx on Debian
  command: apt-get install -y nginx
  when: "'Debian' in os_info.stdout_lines[0]"

- name: Install Nginx on Red Hat
  command: amazon-linux-extras install nginx1
  when: "'Amazon' in os_info.stdout_lines[0] or 'Red Hat' in os_info.stdout_lines[0]"

- name: Install Nginx and other tools.
  package:
    name: ["aws-cli"]
    state: present

- name: Starting the nginx service.
  service:
    name: nginx
    state: started
    enabled: yes

- name: Copying the index.html template to /usr/share/nginx/html
  template:
    src: index.html.j2
    dest: /usr/share/nginx/html/index.html
